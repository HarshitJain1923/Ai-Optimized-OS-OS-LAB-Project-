# Custom Pop!_OS Build Environment

This repository contains a Makefile and configuration files to build a customized Pop!_OS ISO image. This specific configuration focuses on pre-installing tools useful for GPU computing and monitoring, and incorporates a machine learning component to dynamically optimize power management profiles.

## Overview

The primary goal of this build configuration is to create a Pop!_OS (`22.04` by default) ISO that comes ready with:

1.  **NVIDIA CUDA Toolkit:** Essential for GPU-accelerated computing tasks, particularly in machine learning and scientific computing.
2.  **Custom Python GPU Monitor:** A simple graphical tool to monitor GPU usage, built using Python, Tkinter, pynvml, and Matplotlib.
3.  **ML-Optimized Power Management:** An experimental feature integrated into the system's power management daemon to adaptively select power profiles based on system load and learned behavior.

These additions are integrated during the ISO build process or are intended modifications to the underlying system packages included in the build.

## Key Modifications & Features

### 1. Pre-installed GPU Tools (via `Makefile`)

The standard ISO build process (`iso` target in the `Makefile`) has been modified to include the following steps:

* **Install CUDA:**
    * Updates the package list (`sudo apt-get update`).
    * Installs the `cuda` package using APT (`sudo apt-get install -y cuda`). This provides the necessary NVIDIA drivers, CUDA toolkit, and libraries.
    * *Note:* Specific ML frameworks like PyTorch/TensorFlow are **not** installed by this script, but the pre-installed CUDA enables users to easily install GPU-accelerated versions post-installation.

* **Install GPU Monitor Dependencies:**
    * Installs `python3-tk` and `python3-pip` via APT.
    * Installs `pynvml` and `matplotlib` via `pip`.

* **Copy GPU Monitor Files:**
    * Copies `gpu.py` and `gpu.png` to `/opt/gpu-monitor` in the ISO.
    * **Important:** You **must** replace the placeholder paths (`path/to/gpu.py`, `path/to/gpu.png`) in the `Makefile` with the actual paths.

* **Create Desktop Shortcut:**
    * Creates `gpu-monitor.desktop` in `/usr/share/applications` for easy launching from the application menu.

* **Set Executable Permissions:**
    * Makes `gpu.py` executable.

### 2. ML-Optimized Power Management (via Code Modifications)

This build aims to include modifications to the system's power management daemon (likely `system76-power` or similar, based on the code structure provided) to introduce adaptive power profile selection using machine learning.

* **Goal:** To dynamically adjust system power profiles (`Performance`, `Balanced`, `Battery`) based on current system load and learned usage patterns, potentially improving responsiveness when needed and conserving battery life otherwise.
* **Technique:** Implements a simple Reinforcement Learning agent (Q-learning).
* **How it Works:**
    * **State:** Monitors the system's CPU load average (`/proc/loadavg`) to determine the current state (e.g., low, medium, high load).
    * **Actions:** Selects one of the available power profiles (`performance`, `balanced`, `battery`).
    * **Learning:** Calculates a reward based on current CPU load and whether the system is running on battery power. It learns over time which profile selection leads to better outcomes (e.g., lower load on battery, responsiveness when plugged in) for different states.
    * **Persistence:** The learned model (Q-values) is periodically saved to `/var/lib/system76-power/ml_model.dat` and reloaded when the service starts.
* **Integration:** The power profile setting mechanism consults this learning agent to intelligently suggest or select a profile. The system aims to primarily use the ML-derived profile but may occasionally use a user-specified profile based on internal logic (e.g., the 70/30 split seen in the example `set_profile` function).

## Prerequisites for Building

Before running `make`, ensure you have:

* A Linux environment (preferably Debian/Ubuntu-based).
* Standard build tools (`make`, etc.).
* Dependencies required by the Pop!_OS build system.
* The `gpu.py` script and `gpu.png` icon file available at the locations you specify in the `Makefile`.
* If implementing the ML power management, the modified Rust code needs to be compiled and integrated into the relevant system package that will be included in the ISO build (this step is *not* covered by the provided `Makefile` snippet).
* Sufficient disk space and `sudo` privileges.

## How to Build

1.  **Configure:** Review variables in the `Makefile`.
2.  **Update Paths:** Edit the `iso:` target in `Makefile` and replace `path/to/gpu.py` and `path/to/gpu.png`.
3.  **Build the ISO:**
    ```bash
    make iso
    ```
4.  **Build All (Optional):**
    ```bash
    make all
    ```

The resulting ISO file will be located in the `build/` directory.

## Post-Installation Notes

After installing Pop!_OS using the ISO generated by this configuration:

* The NVIDIA CUDA Toolkit will be pre-installed.
* The "GPU Monitor" application should be available in your application menu.
* The power management system should incorporate the ML-based adaptive profile selection (assuming the modified daemon was correctly built and included in the ISO). The system will learn and adjust profile usage over time.
* You may still need to install GPU-accelerated ML frameworks (PyTorch, TensorFlow) manually via `pip` or other package managers.



# Pop!\_OS ISO production

This repository contains the tools necessary for building Pop!\_OS ISOs.

## Requirements

First you need to import the Pop!\_OS ISO signing key:

```sh
gpg --recv-keys 204DD8AEC33A7AFF
```

Then you need to generate your own GPG key and upload it to a keyserver:

```sh
gpg --full-gen-key
gpg --send-keys --keyserver keyserver.ubuntu.com ${YOUR_KEY_ID_HERE}
```

While you are waiting for your key to be uploaded, install the dependencies:

```sh
./deps.sh
```

## Building

The build is controlled by the Makefile. The following commands can be used:
- `make` - Build an ISO at `build/17.10/pop-os.iso`
- `make qemu_bios` - Run the ISO in BIOS mode
- `make qemu_uefi` - Run the ISO in UEFI mode
- `make clean` - Remove the build files, keeping the debootstrap
- `make distclean` - Remove the debootstrap and other build files

The configuration can be changed in `mk/config.mk`.

To rebuild the ISO when you have made changes, you can use `make clean && make`
